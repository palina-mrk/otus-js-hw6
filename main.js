(()=>{function e(e,t){e.querySelector("#cityName").innerHTML=t.name,e.querySelector("#currentDateTime").innerHTML=Date().split(" ").filter((e,t)=>t<4).join(" "),e.querySelector(".weather-icon").innerHTML=`<img src="https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png" alt="${t.weather[0].description}" />`,e.querySelector(".temperature").innerHTML=`${t.main.temp} &deg;С`,e.querySelector(".weather-description").innerHTML=t.weather[0].description,e.querySelectorAll(".weather-detail")[0].lastElementChild.lastElementChild.innerHTML=`${t.wind.speed} м/с`,e.querySelectorAll(".weather-detail")[1].lastElementChild.lastElementChild.innerHTML=`${t.main.humidity}%`,e.querySelectorAll(".weather-detail")[2].lastElementChild.lastElementChild.innerHTML=`${t.main.pressure} гПа`,e.querySelector("#lastUpdated").innerHTML=`последнее обновление: ${Date(t.dt).split(" ").filter((e,t)=>t<4).join(" ")}`}async function t(e){const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?units=metric&q=${e}&units=metric&lang=ru&appid=63b151efb40928e868a13e6198b120c9`);return t.ok?await t.json():null}function i(e){let t=[],i=[];localStorage.getItem("cityHistory")&&(i=JSON.parse(localStorage.getItem("idHistory")),t=JSON.parse(localStorage.getItem("cityHistory")));const n=i.indexOf(e.id);n>=0&&(t.splice(n,1),i.splice(n,1)),t.unshift(e.name),i.unshift(e.id),t.length>=10&&(t.pop(),i.pop()),localStorage.setItem("cityHistory",JSON.stringify(t)),localStorage.setItem("idHistory",JSON.stringify(i))}async function n(e,i){const n=await t(i);await n&&(e.innerHTML=`\n      <div class="history-item-city">\n        <div class="city-icon">\n          <i class="fas fa-map-marker-alt"></i>\n        </div>\n        <div class="city-info">\n          <h3>${n.name}, ${n.sys.country}</h3>\n          <p>${Date(n.dt).split(" ").filter((e,t)=>t<4).join(" ")}</p>\n        </div>\n      </div>\n      <div class="history-item-weather">\n        <p>${n.main.temp}&deg;С</p>\n        <p>${n.weather[0].description}</p>\n      </div>\n    `)}async function a(r){const l=JSON.parse(localStorage.getItem("cityHistory"));r.innerHTML="";for(let o=0;o<l.length;o++){let c=document.createElement("div");c.classList.add("history-item"),await n(c,l[o]),c.addEventListener("click",async n=>{const r=n.target.querySelector("h3").innerHTML.split(" ")[0],l=await t(r);await l&&(e(document.querySelector("#weatherData"),l),i(l),a(document.querySelector(".history-list")))}),r.append(c)}}!async function(){const n=document.querySelector("#cityForm"),r=document.querySelector("#weatherData"),l=document.querySelector(".history-list");a(l);let o=await async function(){const e=await fetch("https://get.geojs.io/v1/ip/geo.json");if(e.ok){const t=await e.json();return t.city?t.city:t.country}return null}();o||(o="minsk");let c=await t(o);e(r,c),n.addEventListener("submit",async n=>{n.preventDefault();const o=function(e){const t=e.querySelector("input"),i=t.value;return t.value="",i}(n.target),c=await t(o);await c&&(e(r,c),i(c),a(l))})}()})();