(()=>{function e(e,t){e.querySelector("#cityName").innerHTML=t.name,e.querySelector("#currentDateTime").innerHTML=Date().split(" ").filter((e,t)=>t<4).join(" "),e.querySelector(".weather-icon").innerHTML=`<img src="https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png" alt="${t.weather[0].description}" />`,e.querySelector(".temperature").innerHTML=`${t.main.temp} &deg;С`,e.querySelector(".weather-description").innerHTML=t.weather[0].description,e.querySelectorAll(".weather-detail")[0].lastElementChild.lastElementChild.innerHTML=`${t.wind.speed} м/с`,e.querySelectorAll(".weather-detail")[1].lastElementChild.lastElementChild.innerHTML=`${t.main.humidity}%`,e.querySelectorAll(".weather-detail")[2].lastElementChild.lastElementChild.innerHTML=`${t.main.pressure} гПа`,e.querySelector("#lastUpdated").innerHTML=`последнее обновление: ${Date(t.dt).split(" ").filter((e,t)=>t<4).join(" ")}`}async function t(e){const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?units=metric&q=${e}&units=metric&lang=ru&appid=63b151efb40928e868a13e6198b120c9`);return t.ok?await t.json():null}function n(e){let t=[],n=[];localStorage.getItem("cityHistory")&&(n=JSON.parse(localStorage.getItem("idHistory")),t=JSON.parse(localStorage.getItem("cityHistory")));const i=n.indexOf(e.id);i>=0&&(t.splice(i,1),n.splice(i,1)),t.unshift(e.name),n.unshift(e.id),t.length>=10&&(t.pop(),n.pop()),localStorage.setItem("cityHistory",JSON.stringify(t)),localStorage.setItem("idHistory",JSON.stringify(n))}async function i(e,n){const i=await t(n);await i&&(e.innerHTML=`\n      <div class="history-item-city">\n        <div class="city-icon">\n          <i class="fas fa-map-marker-alt"></i>\n        </div>\n        <div class="city-info">\n          <h3>${i.name}, ${i.sys.country}</h3>\n          <p>${Date(i.dt).split(" ").filter((e,t)=>t<4).join(" ")}</p>\n        </div>\n      </div>\n      <div class="history-item-weather">\n        <p>${i.main.temp}&deg;С</p>\n        <p>${i.weather[0].description}</p>\n      </div>\n    `)}async function a(o){const c=JSON.parse(localStorage.getItem("cityHistory"));o.innerHTML="";for(let l=0;l<c.length;l++){let s=document.createElement("div");s.classList.add("history-item"),await i(s,c[l]),o.append(s),s.addEventListener("click",async i=>{const o=i.target.querySelector("h3").innerHTML.split(",")[0],c=await t(o);await c&&(e(document.querySelector("#weatherData"),c),n(c),a(document.querySelector(".history-list")),r(c))})}}async function r(e){await ymaps3.ready;const{YMap:t,YMapDefaultSchemeLayer:n}=ymaps3;document.getElementById("map").firstElementChild&&document.getElementById("map").firstElementChild.remove(),new t(document.getElementById("map"),{location:{center:[e.coord.lon,e.coord.lat],zoom:10}}).addChild(new n)}!async function(){const i=document.querySelector("#cityForm"),o=document.querySelector("#weatherData"),c=document.querySelector(".history-list");a(c);let l=await async function(){const e=await fetch("https://get.geojs.io/v1/ip/geo.json");if(e.ok){const t=await e.json();return t.city?t.city:t.country}return null}();l||(l="moscow");let s=await t(l);e(o,await s),r(await s),i.addEventListener("submit",async i=>{i.preventDefault();const l=function(e){const t=e.querySelector("input"),n=t.value;return t.value="",n}(i.target),s=await t(l);await s&&(e(o,s),n(s),a(c),r(s))}),document.querySelector(".history-container").querySelector(".btn-secondary").addEventListener("click",()=>{localStorage.clear(),a(c)}),i.querySelector("#clearButton").addEventListener("click",()=>{i.querySelector("input").value=""})}()})();