(()=>{function e(e,t){e.querySelector("#cityName").innerHTML=t.name,e.querySelector("#currentDateTime").innerHTML=Date().split(" ").filter((e,t)=>t<4).join(" "),e.querySelector(".weather-icon").innerHTML=`<img src="https://openweathermap.org/img/wn/${t.weather[0].icon}@2x.png" alt="${t.weather[0].description}" />`,e.querySelector(".temperature").innerHTML=`${t.main.temp} &deg;С`,e.querySelector(".weather-description").innerHTML=t.weather[0].description,e.querySelectorAll(".weather-detail")[0].lastElementChild.lastElementChild.innerHTML=`${t.wind.speed} м/с`,e.querySelectorAll(".weather-detail")[1].lastElementChild.lastElementChild.innerHTML=`${t.main.humidity}%`,e.querySelectorAll(".weather-detail")[2].lastElementChild.lastElementChild.innerHTML=`${t.main.pressure} гПа`,e.querySelector("#lastUpdated").innerHTML=`последнее обновление: ${Date(t.dt).split(" ").filter((e,t)=>t<4).join(" ")}`}async function t(e){const t=await fetch(`https://api.openweathermap.org/data/2.5/weather?units=metric&q=${e}&units=metric&lang=ru&appid=63b151efb40928e868a13e6198b120c9`);return t.ok?await t.json():null}function i(e){let t=[],i=[];localStorage.getItem("cityHistory")&&(i=JSON.parse(localStorage.getItem("idHistory")),t=JSON.parse(localStorage.getItem("cityHistory")));const n=i.indexOf(e.id);n>=0&&(t.splice(n,1),i.splice(n,1)),t.unshift(e.name),i.unshift(e.id),t.length>=10&&(t.pop(),i.pop()),localStorage.setItem("cityHistory",JSON.stringify(t)),localStorage.setItem("idHistory",JSON.stringify(i))}async function n(e,i){const n=await t(i);await n&&(e.innerHTML=`\n      <div class="history-item-city">\n        <div class="city-icon">\n          <i class="fas fa-map-marker-alt"></i>\n        </div>\n        <div class="city-info">\n          <h3>${n.name}, ${n.sys.country}</h3>\n          <p>${Date(n.dt).split(" ").filter((e,t)=>t<4).join(" ")}</p>\n        </div>\n      </div>\n      <div class="history-item-weather">\n        <p>${n.main.temp}&deg;С</p>\n        <p>${n.weather[0].description}</p>\n      </div>\n    `)}async function a(r){const o=JSON.parse(localStorage.getItem("cityHistory"));r.innerHTML="";for(let c=0;c<o.length;c++){let l=document.createElement("div");l.classList.add("history-item"),await n(l,o[c]),l.addEventListener("click",async n=>{const r=n.target.querySelector("h3").innerHTML.split(" ")[0],o=await t(r);await o&&(e(document.querySelector("#weatherData"),o),i(o),a(document.querySelector(".history-list")))}),r.append(l)}}!async function(){const n=await fetch("https://api-maps.yandex.ru/v3/?apikey=6f130378-8e07-4626-a413-392271cdb214&lang=ru_RU");console.log(n);const r=document.querySelector("#cityForm"),o=document.querySelector("#weatherData"),c=document.querySelector(".history-list");a(c);let l=await async function(){const e=await fetch("https://get.geojs.io/v1/ip/geo.json");if(e.ok){const t=await e.json();return t.city?t.city:t.country}return null}();l||(l="minsk");let s=await t(l);e(o,s),r.addEventListener("submit",async n=>{n.preventDefault();const r=function(e){const t=e.querySelector("input"),i=t.value;return t.value="",i}(n.target),l=await t(r);await l&&(e(o,l),i(l),a(c))})}()})();